<div id="header-placeholder"></div>


    <br><br><br><br><br><br>
    <h2 class="page-heading">Search your Dream Jobs</h2>
    <div class="search-categories">
        <div class="dropdown">
            <a href="#" class="dropdown-toggle">Categories</a>
            <div class="dropdown-content" id="category-dropdown-content">
                <!-- Categories will be dynamically populated here -->
            </div>
        </div>
        
        <script>
            // Fetch and populate categories
            async function fetchCategories() {
                try {
                    const response = await fetch('/category'); // Adjust the URL if necessary

                    if (!response.ok) {
                        throw new Error(`HTTP error! Status: ${response.status}`);
                    }

                    const data = await response.json();
                    console.log('Fetched categories:', data); // Log the entire fetched data for debugging

                    if (data.success) {
                        const categories = data.data; // Assuming your API response has this structure
                        const dropdownContent = document.getElementById('category-dropdown-content');
                        dropdownContent.innerHTML = ''; // Clear existing items

                        // Create dropdown items
                        categories.forEach(category => {
                            const categoryLink = document.createElement('a');
                            categoryLink.href = '#'; // Update with actual link if needed
                            categoryLink.innerText = category.category_name; // Assuming the category object has this property
                            categoryLink.onclick = (e) => {
                                e.preventDefault(); // Prevent default anchor behavior
                                console.log(`Selected category: ${category.category_name}`); // Handle category selection here
                                fetchJobs(category.id); // Fetch jobs based on the selected category
                            };
                            dropdownContent.appendChild(categoryLink);
                        });
                    } else {
                        console.error('Failed to fetch categories:', data.message);
                    }
                } catch (error) {
                    console.error('Error fetching categories:', error.message); // Log the error message
                }
            }

        
            // Call the fetchCategories function on page load
            document.addEventListener("DOMContentLoaded", fetchCategories);
        </script>
        
        <div class="search-box">
            <input type="text" placeholder="Search for jobs, companies, keywords...">
            <button type="submit"><i class="fas fa-search"></i></button>
        </div>
    </div>
    
     
    <section class="jobs-total">
        <br><br>
        <div class="job-list-total">
            <script>
                // Function to handle navigation
                function navigateToJobDetails(jobId) {
                    const url = `/jobs_details?id=${jobId}`;
                    console.log('Navigating to:', url); // Log the URL
                    location.href = url;
                }
                // Fetch job data from the API
                fetch('/company/add?id=0')
                    .then(response => {
                        if (!response.ok) {
                            throw new Error('Network response was not ok');
                        }
                        return response.json();
                    })
                    .then(response => {
                        console.log(response); // Inspect the data structure here
    
                        // Assuming response.data is the array
                        const jobs = response.data; // Update this if your data structure is different
                        console.log(jobs);
    
                        // Check if jobs is an array
                        if (Array.isArray(jobs)) {
                            const jobListTotal = document.querySelector('.job-list-total'); // Move this outside the loop for efficiency
    
                            // Clear existing content
                            jobListTotal.innerHTML = '';
    
                            // Check if there are jobs available
                            if (jobs.length > 0) {
                                jobs.forEach(job => {
                                    const jobItemTotal = document.createElement('div');
                                    jobItemTotal.classList.add('job-item-total');
    
                                    jobItemTotal.innerHTML = `
                                        <img src="${job.filename || 'images/placeholder.png'}" alt="${job.title} logo" class="job-logo">
                                        <h3>${job.title}</h3>
                                        <p><strong>Position: </strong>${job.position}</p>
                                        <p><strong>Category:</strong> ${job.category_name}</p>
                                        <p><strong>Vacancies:</strong> ${job.no_of_vacancies}</p> <!-- Display the number of vacancies -->
                                        <p><strong>Salary:</strong> ${job.salary}</p>
                                        <p><strong>Gender:</strong> ${job.gender}</p>
                                        <p><strong>Expiry Date:</strong> ${new Date(job.ending_date).toDateString()}</p>
                                        <button onclick="navigateToJobDetails(${job.id})">View More</button>
                                    `;
    
                                    jobListTotal.appendChild(jobItemTotal); // Append job item to the job list
                                });
                            } else {
                                jobListTotal.innerHTML = '<p>No jobs available.</p>'; // Handle case where no jobs are found
                            }
                        } else {
                            console.error('Expected an array, but got:', jobs);
                        }
                    })
                    .catch(error => console.error('Error fetching job data:', error));
            </script>
        </div>
    </section>
</div>
<div id="footer-placeholder"></div>
    <script>
        // Load header and footer
        document.addEventListener("DOMContentLoaded", function() {
            const headerPlaceholder = document.getElementById('header-placeholder');
            const footerPlaceholder = document.getElementById('footer-placeholder');

            fetch('/header')
                .then(response => response.text())
                .then(data => {
                    headerPlaceholder.innerHTML = data;
                    // Initialize toggle button after header is loaded
                    initToggleButton();
                });

            fetch('/footer')
                .then(response => response.text())
                .then(data => {
                    footerPlaceholder.innerHTML = data;
                });

            // Function to initialize toggle button
            function initToggleButton() {
                const toggleButton = document.querySelector(".toggle-button");
                const navLinks = document.querySelector("nav.nav-links");

                if (toggleButton && navLinks) {
                    toggleButton.addEventListener("click", () => {
                        navLinks.classList.toggle("show");
                        console.log("Toggle button clicked. Nav links class is now:", navLinks.className);
                    });
                }
            }

            // Infinite scroll functionality
            const scrollWrapper = document.getElementById('manpower-cards');
            if (scrollWrapper) {
                const cards = Array.from(scrollWrapper.children);
                // Clone the cards to create an infinite scroll effect
                cards.forEach(card => {
                    const clone = card.cloneNode(true);
                    scrollWrapper.appendChild(clone);
                });
            }

            // Image card click functionality
            const imgCard = document.querySelectorAll(".img-card");
            imgCard.forEach(element => {
                element.addEventListener("click", function(e) {
                    imgCard.forEach(el => {
                        el.classList.remove("active");
                    });
                    element.classList.add("active");
                });
            });
        });
    </script>
</body>
</html>
